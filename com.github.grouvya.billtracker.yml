# File: com.github.grouvya.billtracker.yml

# A unique ID for your application in reverse-DNS format.
app-id: com.github.grouvya.billtracker

# The runtime provides the basic environment for your app.
runtime: org.freedesktop.Platform
runtime-version: '23.08' # Match the SDK version you installed.
sdk: org.freedesktop.Sdk

# The command to execute when the app is run.
# If you install a .desktop file, this is often the name of the executable.
command: my-app-launcher.sh

# Finish-args control the sandbox permissions. Be as restrictive as possible.
finish-args:
  # Needed for X11 apps.
  - --socket=fallback-x11
  # Needed for Wayland apps.
  - --socket=wayland
  # Give access to PulseAudio for sound.
  - --socket=pulseaudio
  # Required for inter-process communication.
  - --share=ipc
  # Example: Grant access to the user's Downloads folder.
  # - --filesystem=xdg-downloads

# Modules are the building blocks of your app (source code, dependencies).
modules:
  # First, list your Python dependencies generated in the previous step.
  - name: python3-dependencies
    buildsystem: simple
    build-commands:
      # This command installs all the packages from the generated JSON file.
      - pip3 install --verbose --exists-action=i --no-index --find-links="file://${PWD}" --prefix=${FLATPAK_DEST} -r ${FLATPAK_BUILDER_BUILDDIR}/requirements.txt
    sources:
      # The JSON file generated by flatpak-pip-generator.
      - type: file
        path: python3-dependencies.json
      # Your original requirements.txt file.
      - type: file
        path: requirements.txt

  # Next, define the module for your own application's source code.
  - name: billtracker
    buildsystem: simple
    build-commands:
      # This command installs your Python project into the Flatpak destination.
      - pip3 install --prefix=${FLATPAK_DEST} .
      # You can also install other files manually.
      - install -Dm755 my-app-launcher.sh /app/bin/my-app-launcher.sh
      - install -Dm644 data/com.github.grouvya.billtracker.desktop /app/share/applications/com.github.grouvya.billtracker.desktop
      - install -Dm644 data/com.github.grouvya.billtracker.png /app/share/icons/hicolor/128x128/apps/com.github.grouvya.billtracker.png
      - install -Dm644 data/com.github.grouvya.billtracker.appdata.xml /app/share/appdata/com.github.grouvya.billtracker.appdata.xml
    sources:
      # This MUST point to a downloadable release archive (tar.gz/zip), not a local path.
      - type: archive
        url: https://github.com/grouvya/billtracker/archive/refs/tags/v1.0.0.tar.gz
        sha256: 4f12...your_sha256_checksum_here...b3ac # Replace with the actual checksum
